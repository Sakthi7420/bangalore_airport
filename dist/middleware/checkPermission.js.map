{"version":3,"file":"checkPermission.js","names":["checkPermission","requiredActions","req","res","next","user","permissions","status","json","message","requiredActionsArray","Array","isArray","requiredActionsLower","map","action","toLowerCase","hasPermission","some","permission","includes","exports"],"sources":["../../src/middleware/checkPermission.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\n\r\n// Middleware to check if the user has at least one of the required permissions (case-insensitive)\r\nexport const checkPermission = (requiredActions: string | string[]) => {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    const user = req.user;\r\n\r\n    if (!user || !user.permissions) {\r\n      return res.status(403).json({ message: 'User does not have permissions' });\r\n    }\r\n\r\n    // Normalize input to an array of strings\r\n    const requiredActionsArray = Array.isArray(requiredActions)\r\n      ? requiredActions\r\n      : [requiredActions];\r\n\r\n    // Normalize required actions to lowercase\r\n    const requiredActionsLower = requiredActionsArray.map(action => action.toLowerCase());\r\n\r\n    // Check if the user has any of the required permissions (case-insensitive)\r\n    const hasPermission = user.permissions.some((permission: string) =>\r\n      requiredActionsLower.includes(permission.toLowerCase())\r\n    );\r\n\r\n    if (!hasPermission) {\r\n      return res.status(403).json({ message: 'Permission denied' });\r\n    }\r\n\r\n    next();\r\n  };\r\n};"],"mappings":";;;;;;AAEA;AACO,MAAMA,eAAe,GAAIC,eAAkC,IAAK;EACrE,OAAO,CAACC,GAAY,EAAEC,GAAa,EAAEC,IAAkB,KAAK;IAC1D,MAAMC,IAAI,GAAGH,GAAG,CAACG,IAAI;IAErB,IAAI,CAACA,IAAI,IAAI,CAACA,IAAI,CAACC,WAAW,EAAE;MAC9B,OAAOH,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAiC,CAAC,CAAC;IAC5E;;IAEA;IACA,MAAMC,oBAAoB,GAAGC,KAAK,CAACC,OAAO,CAACX,eAAe,CAAC,GACvDA,eAAe,GACf,CAACA,eAAe,CAAC;;IAErB;IACA,MAAMY,oBAAoB,GAAGH,oBAAoB,CAACI,GAAG,CAACC,MAAM,IAAIA,MAAM,CAACC,WAAW,CAAC,CAAC,CAAC;;IAErF;IACA,MAAMC,aAAa,GAAGZ,IAAI,CAACC,WAAW,CAACY,IAAI,CAAEC,UAAkB,IAC7DN,oBAAoB,CAACO,QAAQ,CAACD,UAAU,CAACH,WAAW,CAAC,CAAC,CACxD,CAAC;IAED,IAAI,CAACC,aAAa,EAAE;MAClB,OAAOd,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAoB,CAAC,CAAC;IAC/D;IAEAL,IAAI,CAAC,CAAC;EACR,CAAC;AACH,CAAC;AAACiB,OAAA,CAAArB,eAAA,GAAAA,eAAA","ignoreList":[]}